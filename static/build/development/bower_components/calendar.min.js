angular.module("ui.calendar",[]).constant("uiCalendarConfig",{}).controller("uiCalendarCtrl",["$scope","$timeout",function(n,e){var r=1,a=1,t=n.eventSources,o=n.calendarWatchEvent?n.calendarWatchEvent:angular.noop,u=function(n){var r;return n&&(r=function(){var r=arguments;e(function(){n.apply(this,r)})}),r};this.eventsFingerprint=function(n){return n.__uiCalId||(n.__uiCalId=a++),""+n.__uiCalId+(n.id||"")+(n.title||"")+(n.url||"")+(+n.start||"")+(+n.end||"")+(n.allDay||"")+(n.className||"")+o(n)||""},this.sourcesFingerprint=function(n){return n.__id||(n.__id=r++)},this.allEvents=function(){for(var n=[],e=0,r=t.length;r>e;e++){var a=t[e];if(angular.isArray(a))n.push(a);else if(angular.isObject(a)&&angular.isArray(a.events)){var o={};for(var u in a)"_uiCalId"!==u&&"events"!==u&&(o[u]=a[u]);for(var l=0;l<a.events.length;l++)angular.extend(a.events[l],o);n.push(a.events)}}return Array.prototype.concat.apply([],n)},this.changeWatcher=function(n,e){var r,a=function(){for(var r,a,t=angular.isFunction(n)?n():n,u=[],l=0,i=t.length;i>l;l++)a=t[l],r=e(a),o[r]=a,u.push(r);return u},t=function(n,e){var r,a,t=[],o={};for(r=0,a=e.length;a>r;r++)o[e[r]]=!0;for(r=0,a=n.length;a>r;r++)o[n[r]]||t.push(n[r]);return t},o={},u=function(n,a){var u,l,i,c,d={},f=t(a,n);for(u=0,l=f.length;l>u;u++){var s=f[u];i=o[s],delete o[s];var v=e(i);v===s?r.onRemoved(i):(d[v]=s,r.onChanged(i))}var g=t(n,a);for(u=0,l=g.length;l>u;u++)c=g[u],i=o[c],d[c]||r.onAdded(i)};return r={subscribe:function(n,e){n.$watch(a,function(n,r){e&&e(n,r)===!1||u(n,r)},!0)},onAdded:angular.noop,onChanged:angular.noop,onRemoved:angular.noop}},this.getFullCalendarConfig=function(n,e){var r={};return angular.extend(r,e),angular.extend(r,n),angular.forEach(r,function(n,e){"function"==typeof n&&(r[e]=u(r[e]))}),r}}]).directive("uiCalendar",["uiCalendarConfig","$locale",function(n,e){var r=function(n){var e,r;e=[];for(r in n)e[r]=n[r];return e},a=e.DATETIME_FORMATS;return n=angular.extend({monthNames:r(a.MONTH),monthNamesShort:r(a.SHORTMONTH),dayNames:r(a.DAY),dayNamesShort:r(a.SHORTDAY)},n||{}),{restrict:"A",scope:{eventSources:"=ngModel",calendarWatchEvent:"&"},controller:"uiCalendarCtrl",link:function(e,r,a,t){function o(){var r,o=a.uiCalendar?e.$parent.$eval(a.uiCalendar):{};r=t.getFullCalendarConfig(o,n),d={eventSources:u},angular.extend(d,r);var l={};for(var i in d)"eventSources"!==i&&(l[i]=d[i]);return JSON.stringify(l)}var u=e.eventSources,l=!1,i=t.changeWatcher(u,t.sourcesFingerprint),c=t.changeWatcher(t.allEvents,t.eventsFingerprint),d=null;e.destroy=function(){e.calendar=a.calendar?e.$parent[a.calendar]=r.html(""):r.html("")},e.init=function(){e.calendar.fullCalendar(d)},i.onAdded=function(n){e.calendar.fullCalendar("addEventSource",n),l=!0},i.onRemoved=function(n){e.calendar.fullCalendar("removeEventSource",n),l=!0},c.onAdded=function(n){e.calendar.fullCalendar("renderEvent",n)},c.onRemoved=function(n){e.calendar.fullCalendar("removeEvents",function(e){return e===n})},c.onChanged=function(n){e.calendar.fullCalendar("updateEvent",n)},i.subscribe(e),c.subscribe(e,function(n,e){return l===!0?(l=!1,!1):void 0}),e.$watch(o,function(n,r){e.destroy(),e.init()})}}}]);